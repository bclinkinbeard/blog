<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Creating Configurable Angular Directives with Providers</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/prism.css">
</head>
<body>
  <header role="banner">
    <div class="container">
      <h1>Creating Configurable Angular Directives with Providers</h1>
    </div>
  </header>
  <div class="container">
    <section><p>As a developer, single-use code is your enemy.</p>
<p>Whenever possible, you avoid creating static, purpose-built code with no use beyond your immediate needs. This is doubly true when talking about components, or as we call them in Angular, directives. Thankfully, Angular provides a built-in mechanism for configuring pieces of an application before it starts running. In this post we&#x2019;ll look at that mechanism itself, as well as how to create components that take advantage of it.</p>
<h2 id="the-hook">The hook</h2>
<p>When defining your application, you are really just configuring your app&#x2019;s root module. In addition to listing its dependencies, you can also use the <a href="https://docs.angularjs.org/api/ng/type/angular.Module">module API</a> to configure various aspects of it.</p>
<p>The part we&#x2019;re interested in here is the <code>config()</code> method. Functions registered using the config method will run when the associated module is loaded. This means that, if defined on your root module, they will be run before any of the other modules in your app have been loaded. This allows us to configure those modules before it&#x2019;s too late.</p>
<pre><code class="language-javascript">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span>&#x2018;app&#x2019;<span class="token punctuation">,</span> <span class="token punctuation">[</span>&#x2018;bilingualButtonModule&#x2019;<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// almost nothing is created/ready yet</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>While it&#x2019;s helpful to have this early hook, it also comes with some limitations. Since the function will run before the <code>bilingualButtonModule</code> module is fully initialized, we can&#x2019;t inject dependencies it defines into our config function.</p>
<p>Actually, I take that back. Sort of.</p>
<h2 id="providers-are-special">Providers are special</h2>
<p>The one part of our non-root modules that <em>are</em> available to our config functions are <a href="https://docs.angularjs.org/guide/providers#provider-recipe">providers</a>.</p>
<p>Using the <code>provider()</code> method of the module API lets you define and expose a custom API that can be used to configure aspects of your own module. That&#x2019;s a bit of a mouthful, so lets look at an example. The following is the <code>bilingualButtonModule</code> that our app depends on in its entirety.</p>
<pre><code class="language-javascript">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">&apos;bilingualButtonModule&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">provider</span><span class="token punctuation">(</span><span class="token string">&apos;bilingualButtonConfig&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>setLocale <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>locale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>locale <span class="token operator">=</span> locale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">&apos;bilingualButton&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">&apos;&lt;button&gt;&lt;/button&gt;&apos;</span><span class="token punctuation">,</span>
      controller<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>$scope<span class="token punctuation">,</span> bilingualButtonConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bilingualButtonConfig<span class="token punctuation">.</span>locale <span class="token operator">===</span> <span class="token string">&apos;es&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          $scope<span class="token punctuation">.</span>greeting <span class="token operator">=</span> <span class="token string">&apos;Hola Mundo&apos;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          $scope<span class="token punctuation">.</span>greeting <span class="token operator">=</span> <span class="token string">&apos;Hello World&apos;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The <code>bilingualButtonConfig</code> provider is what makes the <code>bilingualButton</code> directive configurable. Let&#x2019;s look at each function individually to better understand what is going on.</p>
<h3 id="the-configuration-api">The configuration API</h3>
<p>In this simple example, our configuration API is limited to a single function, defined as <code>this.setLocale()</code>. This function takes an argument and saves its value to a local property named <code>locale</code>. We could just as easily expose multiple methods, or perform more complex logic, or perform any number of tasks.</p>
<h3 id="the-get-method">The $get method</h3>
<p>When <code>bilingualButtonConfig</code> is injected in another part of the app, the <code>$get</code> method&#x2019;s return value will be what actually gets passed to the entity that expressed the dependency. In this case we are simply returning <code>this</code>, which will have a <code>locale</code> property, as long as <code>setLocale()</code> has been called.</p>
<h3 id="the-directive">The directive</h3>
<p>The only thing our module defines besides the <code>bilingualButtonConfig</code> provider is the <code>bilingualButton</code> directive. The directive is super simple, defining a template that is just a button tag whose label is bound to a scope property named <code>greeting</code>, and a controller. The controller gets its scope and our <code>bilingualButtonConfig</code> injected, and sets the <code>greeting</code> property based on the value of <code>bilingualButtonConfig.locale</code>.</p>
<p>We now have a <code>bilingualButtonModule</code> that creates a directive whose appearance is configurable. That&#x2019;s great but&#x2026; how do we configure it?</p>
<h2 id="using-providers">Using providers</h2>
<p>Now that we&#x2019;ve defined a provider, let&#x2019;s look at how to use it. Returning to our root module definition, we can finally implement a proper config function.</p>
<pre><code class="language-javascript">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">&apos;app&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;bilingualButtonModule&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>bilingualButtonConfigProvider<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bilingualButtonConfigProvider<span class="token punctuation">.</span><span class="token function">setLocale</span><span class="token punctuation">(</span><span class="token string">&apos;es&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Notice that we&#x2019;ve used <code>bilingualButtonConfigProvider</code> as the dependency name to request what was defined with <code>.provider(&apos;bilingualButtonConfig&apos;, function () {&#x2026;})</code>. Including the Provider string on the end tells Angular we want the provider rather than the service, factory, value, etc.</p>
<p>In simpler terms that means if you defined a module like this:</p>
<pre><code class="language-javascript">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">&apos;fooModule&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">provider</span><span class="token punctuation">(</span><span class="token string">&apos;foo&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>setBar <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>You could use it like this:</p>
<pre><code class="language-javascript">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">&apos;app&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;fooModule&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>fooProvider<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fooProvider<span class="token punctuation">.</span><span class="token function">setBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We could have done <code>.provider(&apos;bilingualButton&#x2019;, function () {&#x2026;})</code> and <code>.config(function (bilingualButtonProvider) {&#x2026;})</code>, but that ends up getting confusing because you&#x2019;re then injecting a <code>bilingualButton</code> dependency into the controller for a directive also named <code>bilingualButton</code>.</p>
<h3 id="you-ve-used-providers-before">You&#x2019;ve used providers before</h3>
<p>You just didn&#x2019;t know it.</p>
<p>Behind the scenes, <code>module.service()</code> and <code>module.factory()</code> are both implemented as providers. Angular just implements <code>$get</code> for you to create a simpler API that is easier to reason about and has a more concise syntax. For a more thorough explanation, check out <a href="http://joelhooks.com/blog/2013/08/18/configuring-dependency-injection-in-angularjs/">this great post</a> by my friend Joel Hooks.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Providers can be confusing at first, but understanding them is key to building flexible directives. While not the only way to build configurable components, they provide a well documented &#x201C;blessed path&#x201D; for doing so.</p>
<p>The examples from this article can be found in <a href="https://github.com/bclinkinbeard/demo-directives-with-providers">this GitHub repo</a>.</p>
<p>Enjoy!</p>
</section>
  </div>
</body>
</html>
